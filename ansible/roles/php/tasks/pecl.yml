#- name: Install
#  yum: name="php-devel" state=present
#  when: php.pecl_packages is defined

- name: Install Package
  shell: echo "\n\n\n\n\n\n\n\n\n" | pecl install {{ item }}
  register: pecl_result
  changed_when: "pecl_result.rc == 0"
  failed_when: "not (('already installed' in pecl_result.stdout) or ('install ok:' in pecl_result.stdout))"
#  changed_when: "'already installed' not in pecl_result.stdout"
#  failed_when: "pecl_result.stderr or ('ERROR' in pecl_result.stdout)"
  with_items: 
    - redis

- name: Create extension .ini file
  template: >
    src="extension.tpl"
    dest="/etc/php.d/{{ item }}.ini"
    owner="root"
    group="root"
    mode=0644
  with_items: php.pecl_packages
  when: php.pecl_packages is defined

#- name: Enable extension
#  shell: php5enmod {{ item }}
#  with_items: php.pecl_packages
#  when: php.pecl_packages is defined
